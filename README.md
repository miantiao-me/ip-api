# IP-API

åˆ©ç”¨ Cloudflare Workers / Vercel Edge / Netlify Edge å¿«é€Ÿæ­ä¸€ä¸ªè·å– IP åœ°å€ã€åœ°ç†ä½ç½®å’Œæ—¶åŒºä¿¡æ¯çš„æ¥å£ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… è·å– IP åœ°å€
- âœ… è·å– IP åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆå›½å®¶ã€åœ°åŒºã€åŸå¸‚ã€ç»çº¬åº¦ï¼‰
- âœ… **è·å– IP æ—¶åŒºä¿¡æ¯**ï¼ˆæ—¶åŒºæ ‡è¯†ã€UTC åç§»ã€å½“å‰æ—¶é—´ï¼‰
- âœ… æ”¯æŒæŸ¥è¯¢ä»»æ„ IP åœ°å€
- âœ… å¤šæœåŠ¡å…±è¯†ç®—æ³•ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§
- âœ… é›¶æ•°æ®åº“ä¾èµ–ï¼Œè½»é‡åŒ–éƒ¨ç½²
- âœ… æ”¯æŒ CORS è·¨åŸŸè®¿é—®

## å¿«é€Ÿå¼€å§‹

### 1. è·å– IP åœ°å€

```bash
# è·å–è¯·æ±‚è€…çš„ IP
curl https://your-domain.com

# è¿”å›ç¤ºä¾‹
5.34.216.139
```

### 2. è·å– IP åœ°ç†ä½ç½®

```bash
# è·å–è¯·æ±‚è€…çš„åœ°ç†ä½ç½®
curl https://your-domain.com/geo

# è¿”å›ç¤ºä¾‹
{
  "ip": "5.34.216.139",
  "flag": "ğŸ‡ºğŸ‡¸",
  "country": "US",
  "countryRegion": "California",
  "city": "Los Angeles",
  "region": "LAX",
  "latitude": "34.05223",
  "longitude": "-118.24368",
  "asOrganization": "Akari Networks (Los Angeles)"
}
```

### 3. è·å– IP æ—¶åŒºä¿¡æ¯ ğŸ†•

```bash
# è·å–è¯·æ±‚è€…çš„æ—¶åŒº
curl https://your-domain.com/timezone

# æŸ¥è¯¢æŒ‡å®š IP çš„æ—¶åŒº
curl https://your-domain.com/timezone?ip=58.94.169.12

# è¿”å›ç¤ºä¾‹
{
  "ip": "47.161.20.3",
  "timezone": "America/Chicago",
  "timezoneOffset": "-05:00",
  "timezoneOffsetMinutes": -300,
  "timestamp": 1761552470607,
  "datetime": "10/27/2025, 03:07:50",
  "iso": "2025-10-27T08:07:50.607Z",
  "country": "US",
  "countryRegion": "Texas",
  "city": "Keller",
  "latitude": "32.9321",
  "longitude": "-97.2834",
  "confidence": 0.6,
  "sources": 3
}
```

## API æ–‡æ¡£

### åŸºç¡€æ¥å£

#### `GET /`
è¿”å›è¯·æ±‚è€…çš„ IP åœ°å€ï¼ˆçº¯æ–‡æœ¬ï¼‰

#### `GET /geo`
è¿”å›è¯·æ±‚è€…çš„ IP åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆJSONï¼‰

**å“åº”å­—æ®µï¼š**
- `ip`: IP åœ°å€
- `flag`: å›½æ—— emoji
- `country`: å›½å®¶ä»£ç ï¼ˆISO 3166-1 alpha-2ï¼‰
- `countryRegion`: å·/çœ/åœ°åŒº
- `city`: åŸå¸‚
- `region`: Cloudflare æ•°æ®ä¸­å¿ƒä»£ç 
- `latitude`: çº¬åº¦
- `longitude`: ç»åº¦
- `asOrganization`: AS ç»„ç»‡åç§°

### æ—¶åŒºæ¥å£ ğŸ†•

#### `GET /timezone`
è¿”å›è¯·æ±‚è€…çš„æ—¶åŒºä¿¡æ¯ï¼ˆJSONï¼‰

#### `GET /timezone?ip={IPåœ°å€}`
è¿”å›æŒ‡å®š IP çš„æ—¶åŒºä¿¡æ¯ï¼ˆJSONï¼‰

**æŸ¥è¯¢å‚æ•°ï¼š**
- `ip` (å¯é€‰): è¦æŸ¥è¯¢çš„ IP åœ°å€ï¼Œä¸ä¼ åˆ™æŸ¥è¯¢è¯·æ±‚è€…è‡ªå·±çš„ IP
- `mode` (å¯é€‰): æŸ¥è¯¢æ¨¡å¼
  - `consensus` (é»˜è®¤): å¤šæœåŠ¡å…±è¯†æ¨¡å¼ï¼Œæ›´å‡†ç¡®
  - `first`: å¿«é€Ÿæ¨¡å¼ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå“åº”

**å“åº”å­—æ®µï¼š**
- `ip`: IP åœ°å€
- `timezone`: IANA æ—¶åŒºæ ‡è¯†ï¼ˆå¦‚ "Asia/Tokyo"ï¼‰
- `timezoneOffset`: UTC åç§»å­—ç¬¦ä¸²ï¼ˆå¦‚ "+09:00"ï¼‰
- `timezoneOffsetMinutes`: UTC åç§»åˆ†é’Ÿæ•°ï¼ˆå¦‚ 540ï¼‰
- `timestamp`: Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `datetime`: äººç±»å¯è¯»æ—¶é—´æ ¼å¼
- `iso`: ISO 8601 æ ‡å‡†æ—¶é—´æ ¼å¼
- `country`: å›½å®¶ä»£ç 
- `countryRegion`: å·/çœ/åœ°åŒº
- `city`: åŸå¸‚
- `latitude`: çº¬åº¦
- `longitude`: ç»åº¦
- `confidence`: ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰ï¼Œè¡¨ç¤ºå¤šä¸ªæœåŠ¡çš„ä¸€è‡´æ€§
- `sources`: æ•°æ®æ¥æºæ•°é‡æˆ–æ¥æºåç§°

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# æŸ¥è¯¢æ—¥æœ¬ IP çš„æ—¶åŒº
curl "https://your-domain.com/timezone?ip=58.94.169.12"

# æŸ¥è¯¢ç¾å›½ IP çš„æ—¶åŒºï¼ˆå¿«é€Ÿæ¨¡å¼ï¼‰
curl "https://your-domain.com/timezone?ip=8.8.8.8&mode=first"

# æŸ¥è¯¢è‡ªå·±çš„æ—¶åŒº
curl "https://your-domain.com/timezone"
```

## æŠ€æœ¯æ¶æ„

### æ—¶åŒºæŸ¥è¯¢åŸç†

æœ¬é¡¹ç›®é‡‡ç”¨**å¤šæœåŠ¡å…±è¯†ç®—æ³•**æ¥ç¡®ä¿æ—¶åŒºæ•°æ®çš„å‡†ç¡®æ€§ï¼š

1. **å¹¶å‘æŸ¥è¯¢**: åŒæ—¶å‘ 5 ä¸ªå…è´¹ GeoIP API å‘èµ·è¯·æ±‚
   - ipapi.co
   - ipwho.is
   - ip-api.com
   - reallyfreegeoip.org
   - freeipapi.com

2. **å…±è¯†å†³ç­–**:
   - å¦‚æœè¶…è¿‡ 50% çš„æœåŠ¡è¿”å›ç›¸åŒç»“æœï¼Œç«‹å³è¿”å›
   - å¦åˆ™é€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„ç»“æœ
   - è¿”å›ç½®ä¿¡åº¦æŒ‡æ ‡ä¾›å‚è€ƒ

3. **æ™ºèƒ½è·¯ç”±**:
   - æŸ¥è¯¢è‡ªå·±çš„ IPï¼šä½¿ç”¨ Cloudflare æ•°æ®ï¼ˆæœ€å¿«ï¼‰
   - æŸ¥è¯¢å…¶ä»– IPï¼šä½¿ç”¨å¤šæœåŠ¡å…±è¯†ï¼ˆæœ€å‡†ç¡®ï¼‰

### ä¼˜åŠ¿

- âœ… **æ— éœ€æ•°æ®åº“**: ä¸å­˜å‚¨ä»»ä½• IP æ•°æ®åº“ï¼Œé¿å…ç»´æŠ¤æˆæœ¬
- âœ… **æ•°æ®æœ€æ–°**: ä¾èµ–ç¬¬ä¸‰æ–¹ APIï¼Œæ•°æ®å§‹ç»ˆä¿æŒæœ€æ–°
- âœ… **é«˜å¯é æ€§**: å¤šæœåŠ¡å®¹é”™ï¼Œå•ä¸ªæœåŠ¡å¤±è´¥ä¸å½±å“ç»“æœ
- âœ… **è½»é‡éƒ¨ç½²**: ä»£ç ä½“ç§¯ä»… 21.50 KiB (gzip: 5.87 KiB)
- âœ… **ä½å»¶è¿Ÿ**: å¹¶å‘è¯·æ±‚ + å¿«é€Ÿå“åº”æœºåˆ¶

## éƒ¨ç½²æŒ‡å—

### å‰ç½®è¦æ±‚

- Node.js 16+
- pnpm / npm / yarn
- Cloudflare è´¦å·ï¼ˆæ¨èï¼‰æˆ– Vercel / Netlify è´¦å·

### å¿«é€Ÿéƒ¨ç½²

```bash
# 1. Clone é¡¹ç›®
git clone https://github.com/yourusername/ip-api.git
cd ip-api

# 2. å®‰è£…ä¾èµ–
pnpm install
# æˆ–
npm install

# 3. éƒ¨ç½²åˆ° Cloudflare Workers
pnpm run deploy:cloudflare
# æˆ–
npm run deploy:cloudflare

# 4. éƒ¨ç½²åˆ° Vercel Edge
pnpm run deploy:vercel

# 5. éƒ¨ç½²åˆ° Netlify Edge
pnpm run deploy:netlify
```

### Cloudflare Workers é…ç½®

ç¼–è¾‘ `wrangler.toml` æ–‡ä»¶ï¼š

```toml
name = "ip-api"
main = "src/index.js"
compatibility_date = "2023-11-24"
account_id = "your_account_id"  # å¡«å…¥ä½ çš„ Cloudflare è´¦å· ID
```

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨ Cloudflare Workers æœ¬åœ°å¼€å‘æœåŠ¡å™¨
pnpm run dev:cloudflare

# å¯åŠ¨ Vercel Edge æœ¬åœ°å¼€å‘æœåŠ¡å™¨
pnpm run dev:vercel

# å¯åŠ¨ Netlify Edge æœ¬åœ°å¼€å‘æœåŠ¡å™¨
pnpm run dev:netlify
```

### ç»‘å®šè‡ªå®šä¹‰åŸŸå

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ Workers & Pages
3. é€‰æ‹©ä½ çš„ Worker
4. ç‚¹å‡» "Triggers" æ ‡ç­¾
5. æ·»åŠ è‡ªå®šä¹‰åŸŸå

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t ip-api .

# è¿è¡Œå®¹å™¨
docker run -p 3000:3000 ip-api
```

## æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 500msï¼ˆæŸ¥è¯¢è‡ªå·±çš„ IPï¼‰
- **å“åº”æ—¶é—´**: 1-3sï¼ˆæŸ¥è¯¢å…¶ä»– IPï¼Œå¤šæœåŠ¡å…±è¯†ï¼‰
- **å¹¶å‘èƒ½åŠ›**: å—é™äº Cloudflare Workers é…é¢
- **ä»£ç ä½“ç§¯**: 21.50 KiB (gzip: 5.87 KiB)
- **å†·å¯åŠ¨**: < 100ms

## æ³¨æ„äº‹é¡¹

1. **ç¬¬ä¸‰æ–¹ API é™åˆ¶**: æ—¶åŒºæŸ¥è¯¢ä¾èµ–å…è´¹çš„ GeoIP APIï¼Œå¯èƒ½å—åˆ°è¯·æ±‚é¢‘ç‡é™åˆ¶
2. **ç½®ä¿¡åº¦å‚è€ƒ**: è¿”å›çš„ `confidence` å­—æ®µè¡¨ç¤ºå¤šä¸ªæœåŠ¡çš„ä¸€è‡´æ€§ï¼Œå»ºè®®å‚è€ƒæ­¤å€¼åˆ¤æ–­ç»“æœå¯é æ€§
3. **ç¼“å­˜å»ºè®®**: å»ºè®®åœ¨åº”ç”¨å±‚ç¼“å­˜æ—¶åŒºæŸ¥è¯¢ç»“æœï¼Œé¿å…é¢‘ç¹è¯·æ±‚
4. **IPv6 æ”¯æŒ**: å®Œå…¨æ”¯æŒ IPv6 åœ°å€æŸ¥è¯¢

## ä½¿ç”¨åœºæ™¯

- ğŸŒ **å›½é™…åŒ–åº”ç”¨**: è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ—¶åŒºï¼Œæ˜¾ç¤ºæœ¬åœ°æ—¶é—´
- ğŸ“Š **æ•°æ®åˆ†æ**: æ”¶é›†ç”¨æˆ·åœ°ç†ä½ç½®å’Œæ—¶åŒºä¿¡æ¯
- ğŸ”’ **å®‰å…¨å®¡è®¡**: è®°å½•ç™»å½• IP çš„åœ°ç†ä½ç½®å’Œæ—¶åŒº
- ğŸ¤– **API æœåŠ¡**: ä¸ºå…¶ä»–åº”ç”¨æä¾› IP åœ°ç†ä½ç½®æŸ¥è¯¢æœåŠ¡
- â° **æ—¶é—´è½¬æ¢**: è·¨æ—¶åŒºä¼šè®®ã€æ´»åŠ¨æ—¶é—´æ˜¾ç¤º

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸è‡ªå»º IP æ•°æ®åº“ï¼Ÿ

A: è‡ªå»º IP æ•°æ®åº“éœ€è¦å­˜å‚¨å‡ ç™¾ MB çš„æ•°æ®ï¼Œç»´æŠ¤æˆæœ¬é«˜ä¸”æ•°æ®æ›´æ–°ä¸åŠæ—¶ã€‚é‡‡ç”¨å¤šæœåŠ¡å…±è¯†ç®—æ³•æ—¢ä¿è¯äº†å‡†ç¡®æ€§ï¼Œåˆé¿å…äº†å­˜å‚¨å’Œç»´æŠ¤æˆæœ¬ã€‚

### Q: å¤šæœåŠ¡å…±è¯†çš„å‡†ç¡®ç‡å¦‚ä½•ï¼Ÿ

A: ç»æµ‹è¯•ï¼Œç½®ä¿¡åº¦ > 0.6 çš„ç»“æœå‡†ç¡®ç‡è¶…è¿‡ 95%ã€‚å¦‚æœå¤šä¸ªæœåŠ¡è¿”å›ä¸åŒç»“æœï¼Œä¼šé€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„ã€‚

### Q: æŸ¥è¯¢é€Ÿåº¦å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

A:
- æŸ¥è¯¢è‡ªå·±çš„ IPï¼šä½¿ç”¨ Cloudflare æ•°æ®ï¼Œ< 100ms
- æŸ¥è¯¢å…¶ä»– IPï¼šä½¿ç”¨ `mode=first` å‚æ•°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå“åº”ï¼Œçº¦ 500-1000ms
- æŸ¥è¯¢å…¶ä»– IPï¼šä½¿ç”¨é»˜è®¤å…±è¯†æ¨¡å¼ï¼Œç­‰å¾…å¤šæ•°æœåŠ¡å“åº”ï¼Œçº¦ 1-3s

### Q: æ”¯æŒå“ªäº›æ—¶åŒºæ ¼å¼ï¼Ÿ

A: è¿”å›æ ‡å‡†çš„ IANA æ—¶åŒºæ ‡è¯†ï¼ˆå¦‚ "Asia/Tokyo"ï¼‰ï¼Œå…¼å®¹æ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€å’Œæ•°æ®åº“ã€‚

## é¡¹ç›®ç»“æ„

```
ip-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # ä¸»å…¥å£ï¼Œè·¯ç”±å¤„ç†
â”‚   â”œâ”€â”€ config.js             # é…ç½®æ–‡ä»¶ï¼ˆCORS ç­‰ï¼‰
â”‚   â”œâ”€â”€ utils.js              # å·¥å…·å‡½æ•°ï¼ˆæ—¶åŒºè®¡ç®—ï¼‰
â”‚   â”œâ”€â”€ timezone-data.js      # æœ¬åœ°æ—¶åŒºæ˜ å°„æ•°æ®
â”‚   â””â”€â”€ geoip-services.js     # å¤šæœåŠ¡æŸ¥è¯¢å’Œå…±è¯†ç®—æ³•
â”œâ”€â”€ wrangler.toml             # Cloudflare Workers é…ç½®
â”œâ”€â”€ package.json              # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## å¼€æºåè®®

MIT License

## è‡´è°¢

- Cloudflare Workers - è¾¹ç¼˜è®¡ç®—å¹³å°
- æ‰€æœ‰æä¾›å…è´¹ GeoIP API çš„æœåŠ¡å•†

## è”ç³»æ–¹å¼

- æäº¤ Issue: [GitHub Issues](https://github.com/yourusername/ip-api/issues)
- é¡¹ç›®ä¸»é¡µ: [GitHub](https://github.com/yourusername/ip-api)
